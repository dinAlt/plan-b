!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).planB=e()}}(function(){return function i(a,u,c){function f(n,e){if(!u[n]){if(!a[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(l)return l(n,!0);var r=new Error("Cannot find module '"+n+"'");throw r.code="MODULE_NOT_FOUND",r}var o=u[n]={exports:{}};a[n][0].call(o.exports,function(e){return f(a[n][1][e]||e)},o,o.exports,i,a,u,c)}return u[n].exports}for(var l="function"==typeof require&&require,e=0;e<c.length;e++)f(c[e]);return f}({1:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e("./planner");t.plan=r.plan,t.lastExecuted=r.lastExecuted},{"./planner":2}],2:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i,o=e("./storage"),a=e("./util"),u=e("./validate");function c(e){var n=Number(i.getItem("task:"+e.name));if(n)return new Date(n)}t.plan=function(e){i=localStorage||o.cookieStorage,u.validateTasks(e),(r=e).forEach(function(e){var n;(n=e).actions&&n.actions.length&&n.triggers.forEach(function(e){(function(e,n){var t=c(e);if(n.plan){if("once"===n.plan)return!t;var r=void 0;if(r="object"==typeof n.plan?n.plan[0]*a.intervalToMilliseconds(n.plan[1]):a.intervalToMilliseconds(n.plan),t&&Date.now()-t.getTime()<r)return!1}return!0})(n,e)&&"init"===e.on&&function(e,n,t,r){void 0===t&&(t=0),void 0===r&&(r=0);var o=function(){n.check&&!n.check(e.name)||(e.actions.forEach(function(e){return e()}),i.setItem("task:"+e.name,(new Date).getTime().toString()))};setTimeout(function(){o(),r&&setInterval(o,r)},t)}(n,e,e.timeout||0,e.repeat||0)})})},t.lastExecuted=function(n){var e=r.filter(function(e){return e.name===n});if(e.length)return c(e[0])}},{"./storage":3,"./util":4,"./validate":5}],3:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cookieStorage={getItem:function(e){return n=e,document.cookie.replace(new RegExp("(?:(?:^|.*;\\s*)"+encodeURIComponent(n)+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1");var n},setItem:function(e,n){!function(e,n,t,r){void 0===r&&(r="/");var o=encodeURIComponent(e)+"="+encodeURIComponent(n)+"; path="+encodeURIComponent(r)+";";t&&(o+="number"==typeof t?" max-age="+t:" expires="+t.toUTCString());document.cookie=o}(e,n,94608e3,"/")}}},{}],4:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.intervalToMilliseconds=function e(n){switch(n){case"second":return 1e3;case"minute":return 60*e("second");case"hour":return 60*e("minute");case"day":return 24*e("hour");case"week":return 7*e("day");default:throw new Error('Invalid "interval" value '+n)}}},{}],5:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e("./util");function o(n){n.triggers.forEach(function(e){if("init"!==e.on)throw new Error('Triggers "on" property should be one of ("init",), got '+e.on+', task: "'+n.name+'"');if(e.repeat&&"number"!=typeof e.repeat)throw new Error('Triggers "repeat.each" property should be a number, task: "'+n.name+'"');!function(e,n){if(e.plan){if("once"===e.plan)return;if("string"==typeof e.plan)return r.intervalToMilliseconds(e.plan);if(e.plan.length&&2===e.plan.length&&"number"==typeof e.plan[0])return r.intervalToMilliseconds(e.plan[1]);throw new Error("Invalid trigger plan: "+e.plan+", task: "+n.name)}}(e,n)})}t.validateTasks=function(e){e.forEach(function(e){if(!e.name)throw new Error("Task name required");var n;o(e),(n=e).actions.forEach(function(e){if("function"!=typeof e)throw new Error('Action should be a function, task: "'+n.name+'"')})})}},{"./util":4}]},{},[1])(1)});